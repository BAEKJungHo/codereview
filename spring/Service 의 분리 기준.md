# SectionService ëŠ” ë¶„ë¦¬í•˜ëŠ”ê²Œ ë§ëŠ”ê°€?

> @ Reviewer : ì¹´ì¹´ì˜¤ ëª¨ë¹Œë¦¬í‹° ìµœì¤€ìš°
> 
> > @ Reviewer : ë¥˜ì„±í˜„(ë¸Œë¼ìš´)

### Q

êµ¬ê°„ì„ ë§Œë“¤ë•Œ, REST APIë¥¼ ì„¤ê³„í•˜ëŠ” ê²ƒì€ ì–´ë µì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. êµ¬ê°„ì€ ë…¸ì„ ì´ ë“±ë¡ë˜ê³  ë‚˜ì„œì•¼ ë“±ë¡ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì—, `ë…¸ì„ /ë…¸ì„ ID/êµ¬ê°„/êµ¬ê°„ID` í˜•ì‹ìœ¼ë¡œ URI ë¥¼ í‘œí˜„í•˜ëŠ”ê²Œ ë§ë‹¤ê³  ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.

ë¬¸ì œëŠ” Service ì˜€ëŠ”ë°,, ì œê°€ í•œ ê³ ë¯¼ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

1. LineService ì—ì„œ Section ì˜ ë“±ë¡, ì‚­ì œ ë“±ì˜ ìœ ìŠ¤ì¼€ì´ìŠ¤ë¥¼ ë‚˜íƒ€ë‚´ê²Œ ë˜ë©´ ê¸°ì¡´ì— ì—†ë˜ StationRepository ì˜ì¡´ì„±ì´ ìƒê¸´ë‹¤ê³  íŒë‹¨í•˜ì—¬ ë¶„ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.

2. í˜„ì¬ ì„œë¹„ìŠ¤ë“¤ì´ application íŒ¨í‚¤ì§€ ë°‘ì— ì¡´ì¬í•˜ë©°, ì‹¤ì œë¡œ í•˜ê³  ìˆëŠ” ì—­í• ë„ ë„ë©”ì¸ ì„œë¹„ìŠ¤ê°€ ì•„ë‹Œ ìœ ìŠ¤ì¼€ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” `ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤`ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. 

ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ì´ë‹¤ë³´ë‹ˆ, Presentation Layer (LineController) ì— ìˆëŠ” API ê¸°ëŠ¥ì„ LineService ì— ê´€ë¦¬í•˜ë„ë¡ í•˜ëŠ”ê²Œ ë§ëŠ”ê²ƒ ê°™ê¸°ë„í•˜ê³ ..

Line Entity ì™€ Section Entity ì˜ ê´€ê²Œë¥¼ ë³´ë©´, Line Entity ì—ì„œ Section Entity ì˜ ìƒëª…ì£¼ê¸°ë¥¼ ê´€ë¦¬í•˜ê³  ìˆê¸´í•˜ì§€ë§Œ,, ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ì˜ ë¶„ë¦¬ ê¸°ì¤€ì´ ìƒëª…ì£¼ê¸°ë¡œ í•˜ëŠ”ê²Œ ë§ëŠ”ê±°ê°€ ì˜ë¬¸ì´ ë“¤ê¸°ë„í•˜ì˜€ìŠµë‹ˆë‹¤.

- __ê°€ì¥ ê¶ê¸ˆí•œ ë‚´ìš© : ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ë¥¼ ë¶„ë¦¬í•˜ëŠ” ê¸°ì¤€__
    - 1. ê° ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ì˜ Persistence Layer ì— ëŒ€í•œ ì˜ì¡´ì„±ì„ ê³ ë ¤í•˜ì—¬ ë¶„ë¦¬í•˜ëŠ” ì§€
    - 2. ìœ ìŠ¤ì¼€ì´ìŠ¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬í•˜ëŠ” ì§€
    - 3. ì—”í‹°í‹°ì˜ ìƒëª…ì£¼ê¸°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬í•˜ëŠ” ì§€

ê·¸ ì™¸ì—ë„ ë‹¤ì–‘í•œ ê¸°ì¤€ì´ ìˆì„ ê²ƒ ê°™ê¸´í•œë°,, 

ì´ì— ëŒ€í•œ ë¦¬ë·°ì–´ë‹˜ ìƒê°ì€ ì–´ë– ì‹ ì§€ ê¶ê¸ˆí•©ë‹ˆë‹¤.

### A

ì € ê°™ì€ ê²½ìš°ëŠ” ìœ ìŠ¤ì¼€ì´ìŠ¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬ë¥¼ í•˜ê²Œë˜ëŠ” í¸ì…ë‹ˆë‹¤. í˜„ì¬ëŠ” ê°„ë‹¨í•œ ë¯¸ì…˜ì´ì§€ë§Œ ì‹¤ë¬´ë¥¼ ì§„í–‰í•˜ë©´ì„œ ìš”êµ¬ì‚¬í•­ì´ ë³µì¡í•´ì§ˆìˆ˜ë¡ ì²˜ìŒì—ëŠ” UserServiceë¡œ ì‹œì‘í–ˆë‹¤ê°€, UserQueryService, UserSignUpService, UserUpdateService ë“±ê³¼ ê°™ì´ ë‚˜ëˆ„ì–´ ì§€ê²Œ ë˜ë”ë¼êµ¬ìš”............
ì •í˜¸ë‹˜ì€ ì‚¬ìš©í•˜ì…¨ì„ ë•Œ ì–´ë–¤ ë°©í–¥ì´ ê°€ì¥ ì¢‹ì€ ê²ƒ ì²˜ëŸ¼ ëŠê»´ì§€ì…¨ëŠ”ì§€ë„ ê¶ê¸ˆí•˜ë„¤ìš” ğŸ‘€

### A. ë‚˜ì˜ ë‹µë³€

ì €ëŠ” ì£¼ë¡œ `Persistence Layer ì— ëŒ€í•œ ì˜ì¡´ì„±ì„ ê³ ë ¤í•˜ì—¬ ë¶„ë¦¬` í•˜ì˜€ë˜ê±° ê°™ì€ë°,,
ì € ê¸°ì¤€ì„ ì‚¬ìš©í•œ ì œ ë‚˜ë¦„ëŒ€ë¡œì˜ ì´ìœ ëŠ” ì•„ë˜ì™€ ê°™ì•˜ìŠµë‹ˆë‹¤.

- ì´ë¯¸ Controller ì˜ í•¸ë“¤ëŸ¬ë©”ì„œë“œë¥¼ í†µí•´ ìì›ê³¼ í–‰ìœ„ê°€ í‘œí˜„ë˜ì–´ ìˆê¸° ë•Œë¬¸ì—
`lines/{lilneId}/sections/{sectionId}` ë¥¼ ë³´ê³  ë‘ ê´€ê³„ë¥¼ ìœ ì¶”í•  ìˆ˜ ìˆë‹¤ê³  ë´…ë‹ˆë‹¤.

- LineService ì—ì„œ Section ì„ ê´€ë¦¬í•˜ê²Œë˜ë©´ ìì—°ìŠ¤ëŸ½ê²Œ StationRepository ì˜ì¡´ì„±ì´
ìƒê¸°ê³ , ì§€ê¸ˆì€ ì„¹ì…˜ì„ ë“±ë¡í•˜ê¸° ìœ„í•´ì„œ StationService ì—ì„œ ì¬ì‚¬ìš©í•´ì•¼í•˜ëŠ” ë©”ì„œë“œê°€ `findStationById` í•˜ë‚˜ì§€ë§Œ,, ì´ê²Œ ì¬ì‚¬ìš©í•´ì•¼í•˜ëŠ” ë©”ì„œë“œê°€ ë§ìœ¼ë©´ ë§ì„ ìˆ˜ë¡ ëˆ„êµ°ê°€ëŠ” `Repository` ê°€ ì•„ë‹Œ `Service` ì— ì˜ì¡´í•˜ê²Œë” ì„¤ê³„í•  ìˆ˜ë„ ìˆë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.

- ê·¸ë ‡ê²Œ ë˜ë©´ ì„¤ê³„ì— ë”°ë¼ì„œ `ìˆœí™˜ì°¸ì¡°` ë°œìƒê°€ëŠ¥ì„±ì´ ë” ì»¤ì§„ë‹¤ê³  ë´ì„œ ì €ëŠ” Persistence Layer ì— ëŒ€í•œ ì˜ì¡´ì„±ì„ ê³ ë ¤í•´ì„œ ë¶„ë¦¬í–ˆë˜ê²ƒ ê°™ìŠµë‹ˆë‹¤.

- ë§Œì•½ì— LinService ì— ëª…ë ¹ê³¼ ì¿¼ë¦¬ë¡œ ë¶„ë¦¬ë˜ì–´ FindService, CommandService ì´ëŸ°ì‹ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì§„ë‹¤ê³  í–ˆì„ë•Œ, ê³¼ì—° saveSection ì€ ì–´ëŠ Service ì— ë“¤ì–´ê°€ì•¼ í•˜ëŠ”ê°€ë¥¼ ìƒê°í•´ë´¤ì„ë•Œ

- CommandService ì— ë“¤ì–´ê°€ëŠ” ìˆœê°„ FindService ì— ìˆëŠ” ì¡°íšŒ ë©”ì„œë“œë¥¼ ì¬ì‚¬ìš©í•  ìˆ˜ ì—†ì–´ì„œ ë©”ì„œë“œë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•´ì•¼ í•˜ì§€ ì•Šì„ê¹Œ í•©ë‹ˆë‹¤. ë˜í•œ saveSection ì— ëŒ€í•œ ê²€ì¦ì„ ì§„í–‰í•˜ê¸° ìœ„í•´ì„œ CommandService ëŠ” ìì—°ìŠ¤ëŸ½ê²Œ StationRepository ì˜ì¡´ì„±ì„ ë°›ê²Œë˜ë¯€ë¡œ, ëˆ„êµ°ê°€ __LineCommandService ë¥¼ ë³´ì•˜ì„ë•Œ, ë…¸ì„ ì„ ë“±ë¡í•˜ê¸° ìœ„í•´ì„œ ì—­ì— ì˜ì¡´í•˜ê³  ìˆë‹¤ë¼ê³  ë³´ì—¬ì§ˆ ìˆ˜ë„ ìˆë‹¤ê³  ë´…ë‹ˆë‹¤.__

- ì´ê²Œ ì§€ê¸ˆì€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤í•˜ë‚˜ë§Œ ì‚¬ìš©í•˜ê³  ìˆê¸´í•˜ì§€ë§Œ, ë„ë©”ì¸ìœ¼ë¡œë¶€í„° íŒŒìƒëœ ë¡œì§ì„ `ë„ë©”ì¸ ì„œë¹„ìŠ¤`ë¡œ ë§Œë“¤ì–´ì„œ ê´€ë¦¬í•˜ë‹¤ê³  í–ˆì„ë•Œ ì•„ë˜ì™€ ê°™ì´ ë˜ì§€ì•Šì„ê¹Œ í•©ë‹ˆë‹¤.

```java
public class LineQueryService {
    private final LineRepository lineRepository;
    private final LineService lineService; // ë„ë©”ì¸ ì„œë¹„ìŠ¤
    private final SectionService sectionService; // ë„ë©”ì¸ ì„œë¹„ìŠ¤
    private final StationRepository stationRepository; // êµ¬ê°„ ì¡°íšŒ ì‹œ í•„ìš”

    // LineQueryService ì— í˜„ì¬ ë„ë©”ì¸ì„œë¹„ìŠ¤ê°€ ì¡´ì¬í•˜ëŠ” ì´ìœ ëŠ”, ë…¸ì„ ê³¼ êµ¬ê°„ì„ ê°ê° ì¡°íšŒí• ë•Œ í•„ìš”í•œ ë„ë©”ì¸ ë¡œì§ì´ ìˆë‹¤ê³  ê°€ì •

    // ìƒëµ
}
```

- LineQueryService ì— ë²Œì¨ ë§ì€ ì˜ì¡´ì„±ì´ ìƒê¸°ê³ , ì‹¤ì œë¡œ ì´ë ‡ê²Œ ë˜ë©´ __í•„ë“œ ë¶€ë¶„(ì–´ë–¤ ì˜ì¡´ì„±ì„ ì£¼ì… ë°›ê³  ìˆëŠ”ì§€)ì„ ë³´ë”ë¼ë„ ë¼ì¸ê³¼ êµ¬ê°„ì˜ ê´€ê³„ë¥¼ ëª…í™•í•˜ê²Œ íŒŒì•…í•˜ê¸° í˜ë“¤ë‹¤ê³  ë³´ì—¬ì§‘ë‹ˆë‹¤.__

> ë¼ì¸ê³¼ êµ¬ê°„ì˜ ê´€ê³„ëŠ” REST API ì„¤ê³„ì™€ ì—”í‹°í‹°ê°„ì˜ ê´€ê³„ë¥¼ í†µí•´ì„œ íŒŒì•…í•˜ëŠ”ê²Œ í›¨ì”¬ ë¹¨ë¼ì§€ê²Œ ëœë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.

### A

- ì •ë‹µì€ ì—†ë‹¤
- Service ë¥¼ ë¶„ë¦¬í•˜ê²Œ ë˜ë©´ ì—­í• ê³¼ ì±…ì„ì´ ì¡°ê¸ˆ ë” êµ¬ì²´ì ì´ë¼ëŠ”ê²Œ ì¥ì ì´ê³ , Section ì€ Line ì— ì¢…ì†ì ì´ê¸° ë•Œë¬¸ì— Line ì•ˆì— ë„£ìœ¼ë©´, êµ¬ê°„ì„ ìƒì„±í• ë•Œ ì½”ë“œê°€ ì¡°ê¸ˆ ë” í‘œí˜„ë ¥ì´ ì¢‹ì•„ì§€ëŠ” ê²ƒ ê°™ë‹¤.

```java
lineService.addSection();

public SectionResponse addSection(final SectionRequest request, final Long id) {
    Line line = getLineById(id);
    Station upStation = findStationById(request.getUpStationId());
    Station downStation = findStationById(request.getDownStationId());

    Sections sections = line.getSections();
    Section newSection = Section.of(line, upStation, downStation, request);
    sections.add(newSection);
    return SectionResponse.of(newSection);
}
```
